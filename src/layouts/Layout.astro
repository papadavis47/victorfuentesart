---
import Footer from '@components/astro/Footer.astro';
import Navigation from '@components/react/Navigation.tsx';
import { ViewTransitions } from 'astro:transitions';
import { getLocaleFromPathname } from '@/i18n/routing';
import { t, type Locale } from '@/i18n';
import '../styles/global.css';

type Props = {
  metaTitle: string;
  transitionType?: 'gallery-wall' | 'brush-wipe';
};

const { metaTitle, transitionType = 'gallery-wall' } = Astro.props;
const locale: Locale = getLocaleFromPathname(Astro.url.pathname);
const description = t(locale, 'meta.description');
---

<html lang={locale}>
  <head>
    <meta charset='utf-8' />
    <link rel='icon' type='image/svg+xml' href='/favicon.ico' />
    <meta name='viewport' content='width=device-width, initial-scale=1' />
    <meta name='description' content={description} />
    <meta name='generator' content={Astro.generator} />
    <title>{`${metaTitle} | Victor Fuentes Art`}</title>
    <ViewTransitions />
    <script is:inline>
      (function() {
        const saved = localStorage.getItem('preferredLocale');
        if (!saved) return;
        const pathname = window.location.pathname;
        const isSpanish = pathname.startsWith('/es/') || pathname === '/es';
        const currentLocale = isSpanish ? 'es' : 'en';
        if (saved !== currentLocale) {
          let newPath;
          if (saved === 'es') {
            newPath = '/es' + (pathname === '/' ? '' : pathname);
          } else {
            newPath = pathname.replace(/^\/es(\/|$)/, '/');
            if (newPath === '') newPath = '/';
          }
          if (newPath !== pathname) {
            window.location.replace(newPath);
          }
        }
      })();
    </script>
  </head>
  <body class='min-h-screen flex flex-col' style='background-color: var(--bg-primary); color: var(--text-primary);'>
    <div transition:name="nav-persist" transition:persist class="relative z-50">
      <Navigation locale={locale} client:load />
    </div>
    <main 
      class='flex-1'
      transition:name={transitionType === 'brush-wipe' ? 'main-content' : undefined}
      transition:animate="initial"
    >
      <slot />
    </main>
    <div transition:name="footer-persist">
      <Footer locale={locale} />
    </div>
  </body>
</html>
